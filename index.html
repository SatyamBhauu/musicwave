<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicWave Library</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons for aesthetic icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
   <link rel="stylesheet" href="style.css">
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <!-- Global state object -->
    <script>
        const state = {
            currentSong: null,
            isPlaying: false,
            currentTime: 0,
            duration: 0,
            volume: 0.5,
            isMuted: false,
        };

        const songs = [
            { id: 1, title: "Cosmic Drift", artist: "Stellar Waves", duration: "3:45", initials: "CD", color: "bg-indigo-600" },
            { id: 2, title: "Urban Echoes", artist: "City Beat", duration: "2:59", initials: "UE", color: "bg-green-600" },
            { id: 3, title: "Forest Retreat", artist: "Ambient Flow", duration: "4:12", initials: "FR", color: "bg-orange-600" },
            { id: 4, title: "Neon Pulse", artist: "City Beat", duration: "3:20", initials: "NP", color: "bg-purple-600" },
            { id: 5, title: "Midnight Drive", artist: "Synth Rider", duration: "3:55", initials: "MD", color: "bg-blue-600" },
            { id: 6, title: "Rainy Day Loop", artist: "Lofi Dreamer", duration: "2:40", initials: "RL", color: "bg-red-600" },
        ];

        // --- Utility Functions for Firebase and LLM API ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const apiKey = ""; // API Key for Gemini

        async function fetchLlmResponse(userPrompt) {
            // Note: This function is a placeholder. You would implement the actual 
            // fetch call here for Gemini if you wanted to use an LLM for features 
            // like generating a personalized playlist description or a song summary.
            console.log("LLM API called with prompt:", userPrompt);

            // Mock API response for demonstration
            return new Promise(resolve => setTimeout(() => {
                resolve("The LLM (Gemini) says: Your prompt was about music, which is awesome! I can help you find new tracks or write album reviews.");
            }, 1000));
        }

        // --- Core UI Update Functions ---
        function renderSidebar() {
            const navItems = [
                { icon: 'home', label: 'Home', active: true },
                { icon: 'search', label: 'Search', active: false },
                { icon: 'library', label: 'Your Library', active: false },
            ];
            
            const sidebar = document.getElementById('sidebar-nav');
            sidebar.innerHTML = navItems.map(item => `
                <a href="#" 
                   class="flex items-center p-3 rounded-xl cursor-pointer interactive-item ${item.active ? 'bg-[#1ed760] bg-opacity-10 text-[#1ed760]' : 'text-gray-400 hover:text-white'}" 
                   onclick="handleNavigation('${item.label}')"
                >
                    <i data-lucide="${item.icon}" class="w-6 h-6 mr-4"></i>
                    <span class="font-semibold text-lg">${item.label}</span>
                </a>
            `).join('');

            // Replace lucide icons
            lucide.createIcons(); 
        }

        function renderSongs() {
            const list = document.getElementById('trending-list');
            list.innerHTML = songs.map((song, index) => `
                <div id="song-${song.id}" 
                     class="song-item flex items-center p-2 rounded-xl cursor-pointer ${state.currentSong?.id === song.id ? 'active' : ''}" 
                     onclick="playSong(${song.id})">
                    <!-- Rank -->
                    <div class="w-8 text-center font-bold text-lg text-gray-400 mr-4">${index + 1}</div>
                    
                    <!-- Initials/Artwork Placeholder -->
                    <div class="w-10 h-10 ${song.color} rounded-md flex items-center justify-center text-white font-bold text-sm mr-4 flex-shrink-0">
                        ${song.initials}
                    </div>

                    <!-- Song Info -->
                    <div class="flex-grow min-w-0">
                        <div class="text-white font-semibold truncate">${song.title}</div>
                        <div class="text-sm text-gray-400 truncate">${song.artist}</div>
                    </div>

                    <!-- Duration -->
                    <div class="text-sm text-gray-400 ml-4 flex-shrink-0">${song.duration}</div>
                </div>
            `).join('');
        }

        function updatePlayerUI() {
            const playerStatus = document.getElementById('player-status');
            const playPauseIcon = document.getElementById('play-pause-icon');
            const timeCurrent = document.getElementById('time-current');
            const timeDuration = document.getElementById('time-duration');
            const progressBarFill = document.getElementById('progress-bar-fill');
            const volumeIcon = document.getElementById('volume-icon');

            if (state.currentSong) {
                playerStatus.innerHTML = `
                    <div class="text-white font-semibold">${state.currentSong.title}</div>
                    <div class="text-xs text-gray-400">${state.currentSong.artist}</div>
                `;
                document.getElementById('select-song-message').classList.add('hidden');
            } else {
                playerStatus.innerHTML = '';
                document.getElementById('select-song-message').classList.remove('hidden');
            }
            
            // Update Play/Pause Icon
            playPauseIcon.setAttribute('data-lucide', state.isPlaying ? 'pause' : 'play');
            lucide.createIcons();

            // Update Time
            const formatTime = (seconds) => {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
            };

            timeCurrent.textContent = formatTime(state.currentTime);
            timeDuration.textContent = formatTime(state.duration);

            // Update Progress Bar
            if (state.duration > 0) {
                const progress = (state.currentTime / state.duration) * 100;
                progressBarFill.style.width = `${progress}%`;
            } else {
                progressBarFill.style.width = '0%';
            }

            // Update Volume Icon
            let volIcon = 'volume-2'; // Default
            if (state.isMuted || state.volume === 0) {
                volIcon = 'volume-x';
            } else if (state.volume > 0.6) {
                volIcon = 'volume-2';
            } else if (state.volume > 0) {
                volIcon = 'volume-1';
            } else {
                volIcon = 'volume-x';
            }
            volumeIcon.setAttribute('data-lucide', volIcon);
            lucide.createIcons();

            // Rerender song list to update 'active' class
            renderSongs();
        }

        // --- Event Handlers and Logic ---

        function playSong(songId) {
            const song = songs.find(s => s.id === songId);
            if (!song) return;

            // Remove active class from previously playing song
            if (state.currentSong) {
                document.getElementById(`song-${state.currentSong.id}`)?.classList.remove('active');
            }

            state.currentSong = song;
            state.duration = parseDuration(song.duration);
            state.currentTime = 0;
            state.isPlaying = true;

            // Add active class to the new song
            document.getElementById(`song-${song.id}`)?.classList.add('active');

            // Start "playback" simulation
            if (state.interval) clearInterval(state.interval);
            state.interval = setInterval(simulatePlayback, 1000);

            updatePlayerUI();
        }

        function parseDuration(durationStr) {
            const [minutes, seconds] = durationStr.split(':').map(Number);
            return minutes * 60 + seconds;
        }

        function simulatePlayback() {
            if (!state.isPlaying || !state.currentSong) return;

            if (state.currentTime < state.duration) {
                state.currentTime += 1;
            } else {
                // Song finished
                state.currentTime = state.duration;
                state.isPlaying = false;
                clearInterval(state.interval);
            }
            updatePlayerUI();
        }

        function togglePlayPause() {
            if (!state.currentSong) return;

            state.isPlaying = !state.isPlaying;
            if (state.isPlaying) {
                if (!state.interval) {
                    state.interval = setInterval(simulatePlayback, 1000);
                }
            } else {
                if (state.interval) {
                    clearInterval(state.interval);
                    state.interval = null;
                }
            }
            updatePlayerUI();
        }

        function seek(event) {
            if (!state.currentSong || state.duration === 0) return;

            const progressBar = document.getElementById('progress-bar-container');
            const rect = progressBar.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            
            state.currentTime = Math.round(state.duration * percentage);
            updatePlayerUI();
        }

        function handleVolumeChange(value) {
            state.volume = value / 100;
            state.isMuted = state.volume === 0;
            updatePlayerUI();
        }

        function toggleMute() {
            state.isMuted = !state.isMuted;
            document.getElementById('volume-slider').value = state.isMuted ? 0 : (state.volume * 100);
            updatePlayerUI();
        }

        function handleNavigation(label) {
            // Placeholder for navigation logic
            document.getElementById('content-title').textContent = label === 'Home' ? 'Trending Now' : label;
        }


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderSidebar();
            renderSongs();
            updatePlayerUI();
            
            // Set initial volume slider position
            document.getElementById('volume-slider').value = state.volume * 100;
        });
    </script>
    
    <!-- 
        Main layout: Sidebar (25%) + Content (75%) 
        The footer music player takes up a fixed height at the bottom.
    -->
    <div class="flex-grow flex custom-scrollbar overflow-hidden">
        
        <!-- Sidebar Navigation (Black) -->
        <div class="sidebar w-64 p-4 flex-shrink-0 bg-[#000] border-r border-[#1e2229]">
            <h1 class="text-2xl font-bold text-white mb-8">MusicWave</h1>
            
            <!-- Navigation Items -->
            <nav id="sidebar-nav" class="space-y-2"></nav>

            <div class="mt-8 pt-4 border-t border-gray-800">
                <p class="text-sm text-gray-500">App ID: ${appId}</p>
            </div>
        </div>

        <!-- Main Content Area (Dark Blue-Grey) -->
        <main class="flex-grow p-6 custom-scrollbar overflow-y-auto">
            
            <!-- Header/Search Bar -->
            <header class="flex items-center justify-between mb-8 sticky top-0 bg-[#0d1117] z-10 pb-4">
                <div class="relative flex-grow max-w-lg">
                    <i data-lucide="search" class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="text" placeholder="Search for songs or artists..."
                           class="w-full p-3 pl-10 rounded-full bg-[#1e2229] text-white focus:outline-none focus:ring-2 focus:ring-[#1ed760] border border-transparent">
                </div>
                
                <!-- Profile Placeholder -->
                <div class="ml-4 flex items-center space-x-4">
                    <i data-lucide="bell" class="w-6 h-6 text-gray-400 cursor-pointer hover:text-white"></i>
                    <div class="w-8 h-8 rounded-full bg-pink-600 flex items-center justify-center text-sm font-bold cursor-pointer">
                        P
                    </div>
                </div>
            </header>

            <!-- Content Section -->
            <h2 id="content-title" class="text-3xl font-bold text-white mb-6">Trending Now</h2>
            
            <div id="trending-list" class="space-y-2">
                <!-- Song items will be inserted here by JavaScript -->
            </div>
            
            <div class="h-20"></div> <!-- Padding for content above the player -->

        </main>
    </div>

    <!-- Footer Music Player (Fixed at Bottom) -->
    <footer class="flex-shrink-0 bg-[#1e2229] p-4 border-t border-gray-800">
        
        <!-- Progress Bar -->
        <div id="progress-bar-container" class="progress-bar-container mb-2" onclick="seek(event)">
            <div id="progress-bar-fill" class="progress-bar-fill"></div>
        </div>

        <div class="flex items-center justify-between">
            
            <!-- Left: Song Info / Message -->
            <div class="w-1/3 min-w-0 flex items-center space-x-3">
                <p id="select-song-message" class="text-sm text-gray-400">Select a song to play...</p>
                <div id="player-status">
                    <!-- Song title and artist will be here -->
                </div>
            </div>

            <!-- Center: Controls and Time -->
            <div class="w-1/3 flex flex-col items-center">
                <div class="flex items-center space-x-6 text-white mb-2">
                    <i data-lucide="shuffle" class="w-5 h-5 text-gray-400 cursor-pointer hover:text-white"></i>
                    <i data-lucide="skip-back" class="w-6 h-6 cursor-pointer hover:text-white"></i>
                    
                    <button id="play-pause-button" onclick="togglePlayPause()"
                            class="w-10 h-10 bg-white text-black rounded-full icon-center hover:scale-105 transition-transform">
                        <!-- Icon will be updated by JS -->
                        <i id="play-pause-icon" data-lucide="play" class="w-5 h-5 fill-current"></i>
                    </button>
                    
                    <i data-lucide="skip-forward" class="w-6 h-6 cursor-pointer hover:text-white"></i>
                    <i data-lucide="repeat" class="w-5 h-5 text-gray-400 cursor-pointer hover:text-white"></i>
                </div>
                
                <!-- Time Display -->
                <div class="flex items-center space-x-2 text-xs font-mono text-gray-400">
                    <span id="time-current">0:00</span>
                    <span id="time-duration">0:00</span>
                </div>
            </div>

            <!-- Right: Volume Control -->
            <div class="w-1/3 flex justify-end items-center space-x-2">
                <i id="volume-icon" data-lucide="volume-2" class="w-5 h-5 text-gray-400 cursor-pointer hover:text-white" onclick="toggleMute()"></i>
                <input id="volume-slider" type="range" min="0" max="100" value="50" step="1"
                       oninput="handleVolumeChange(this.value)"
                       class="w-24 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer range-lg">
                <i data-lucide="list-music" class="w-5 h-5 text-gray-400 cursor-pointer hover:text-white ml-2"></i>
            </div>
        </div>
    </footer>
    
    <!-- Initialize Lucide Icons again in the end to ensure all are rendered -->
    <script>
        lucide.createIcons();
    </script>
</body>
</html>
